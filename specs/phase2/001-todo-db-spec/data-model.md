# Data Model: Todo Application Database

## Overview

This document specifies the data model for the Todo Full-Stack Web Application database. It defines the entities, their attributes, relationships, and constraints as required by the feature specification.

## Entity: User

Represents a registered user of the application. Users are managed by the Better Auth system.

### Fields

| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| id | String | Primary Key, Not Null | Unique identifier for the user, generated by Better Auth |
| email | String | Unique, Not Null | Email address of the user |
| name | String | Not Null | Display name of the user |
| created_at | DateTime | Not Null | Timestamp when the user account was created |

### Relationships

- **One-to-Many**: A user can have many tasks (via tasks.user_id)

### Validation Rules

- Email must be a valid email format
- Name must not be empty
- All fields except those marked as nullable must be present

## Entity: Task

Represents a single todo item in the application.

### Fields

| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| id | Integer | Primary Key, Auto-increment, Not Null | Unique identifier for the task |
| user_id | String | Foreign Key (users.id), Not Null | ID of the user who owns this task |
| title | String | Not Null, Length: 1-200 chars | Title of the task |
| description | Text | Nullable, Max length: 1000 chars | Optional description of the task |
| completed | Boolean | Not Null, Default: false | Completion status of the task |
| created_at | DateTime | Not Null, Default: current timestamp | Timestamp when the task was created |
| updated_at | DateTime | Not Null, Default: current timestamp | Timestamp when the task was last updated |

### Relationships

- **Many-to-One**: A task belongs to one user (via user_id referencing users.id)

### Validation Rules

- Title must be between 1 and 200 characters
- Description must not exceed 1000 characters if provided
- Completed field defaults to false when creating a new task
- Both created_at and updated_at are automatically set to current time

### State Transitions

- **Created**: When a task is first created, `completed` is false, `created_at` and `updated_at` are set to current time
- **Updated**: When a task is modified, `updated_at` is set to current time
- **Completed**: When a task is marked as completed, `completed` becomes true, `updated_at` is set to current time
- **Reopened**: When a task is reopened, `completed` becomes false, `updated_at` is set to current time

## Database Schema

### Tables

```sql
CREATE TABLE users (
    id VARCHAR(255) PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    name VARCHAR(255) NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL
);

CREATE TABLE tasks (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(255) NOT NULL REFERENCES users(id),
    title VARCHAR(200) NOT NULL,
    description TEXT,
    completed BOOLEAN DEFAULT FALSE NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL
);

-- Indexes
CREATE INDEX idx_tasks_user_id ON tasks(user_id);
CREATE INDEX idx_tasks_completed ON tasks(completed);
CREATE INDEX idx_tasks_created_at ON tasks(created_at);
```

## Constraints

### Referential Integrity

- Foreign key constraint ensures that every task's user_id corresponds to an existing user
- Prevents orphaned tasks without a valid user

### Data Validation

- User email must be unique across all users
- Task title must be between 1 and 200 characters
- Task description must not exceed 1000 characters
- Task completion status defaults to false

### Access Control

- All task queries must filter by user_id to enforce user-level isolation
- Users can only access tasks associated with their user_id

## Extension Points

The schema is designed to support future feature additions:

### Optional Fields for Future Expansion

- `due_date`: Could be added to support task deadlines
- `priority`: Could be added to support task prioritization
- `tags`: Could be implemented via a separate tags table and task_tags junction table

### Migration Strategy

- New columns can be added with ALTER TABLE statements
- New tables can be created to support additional features
- Existing constraints will remain intact during migrations